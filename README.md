# OPTCG AI Service

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ **OPTCG AI Service** ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö AI Agent ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°, ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå (Simulation) ‡∏Ç‡∏≠‡∏á **One Piece Card Game** ‡πÇ‡∏î‡∏¢‡∏°‡∏∏‡πà‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ LLM ‡πÅ‡∏•‡∏∞ Multi-Agent Systems ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤

### üéØ Project Scope & Specification (‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡πà‡∏≠)

‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á AI ‡∏ó‡∏µ‡πà "‡∏£‡∏π‡πâ‡∏à‡∏£‡∏¥‡∏á" ‡πÅ‡∏•‡∏∞ "‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô" ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö OPTCG:

1.  **Card Knowledge**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Effect, Attribute ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Hybrid Search: Vector + Structured Data).
2.  **Rule Understanding**: ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à Flow ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô.
3.  **Simulation Engine**: ‡∏°‡∏µ Python Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ (Battle Simulator) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ Win Rate ‡∏Ç‡∏≠‡∏á Deck (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï).
4.  **Meta Analysis**: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° Meta ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î Deck (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï).

---

### ‚úÖ What has been done (‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)

‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á **Phase 1: Foundation & Knowledge Base**

*   **Project Initialization**:
    *   [x] Setup Project Structure ‡πÅ‡∏•‡∏∞ Environment (`uv`).
    *   [x] add Git Repository.
*   **Data Ingestion Pipeline (Refactored)**:
    *   [x] **Automated Pipeline**: ‡πÉ‡∏ä‡πâ `check_for_updates.py` ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Flow (Fetch -> Clean -> Embed) ‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£.
    *   [x] **Data Cleaning**: ‡πÅ‡∏õ‡∏•‡∏á Raw JSON ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Clean JSON ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î field ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏° Deduplication.
    *   [x] **Flexible Embeddings**: ‡∏™‡∏•‡∏±‡∏ö‡πÉ‡∏ä‡πâ `Gemini` ‡∏´‡∏£‡∏∑‡∏≠ `HuggingFace` ‡πÑ‡∏î‡πâ (‡πÄ‡∏Å‡πá‡∏ö Vector ‡πÅ‡∏¢‡∏Å Folder).
*   **Hybrid Search System**:
    *   [x] **Advanced Search**: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á Semantic (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢) ‡πÅ‡∏•‡∏∞ Filter (‡∏™‡∏µ, Cost, Type).
    *   [x] **Dynamic Context**: AI Agent ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (`k`) ‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°.
*   **AI Agent Development**:
    *   [x] **LangGraph Agent:** ‡∏™‡∏£‡πâ‡∏≤‡∏á Knowledge Agent ‡∏ó‡∏µ‡πà‡∏â‡∏•‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Rule Injection ‡πÉ‡∏™‡πà‡∏Å‡∏é‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏á‡πÉ‡∏ô Context.
    *   [x] **Rulebook Knowledge Base:** ‡πÇ‡∏´‡∏•‡∏î `comprehensive_rules.txt` ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà System Prompt ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î.
    *   [x] **API Endpoint**: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô FastAPI (`/api/chat`).
*   **Deployment Ready (Phase 1.5)**:
    *   [x] **Containerization**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Docker & Docker Compose ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô.
*   **Safety & Reliability (Phase 2)**:
    *   [x] **Observability**: Setup **Langfuse** (Tracing) & Implement **Execution Metadata** response.
    *   [x] **Comprehensive Guardrails**: ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô 2 ‡∏ä‡∏±‡πâ‡∏ô (Input/Output) ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° PII, Injection, Toxicity ‡πÅ‡∏•‡∏∞ Structure Validation (Implemented as Middleware Nodes).
    *   [x] **Azure AI Foundry POC:** Compare and implement Azure Content Safety as an alternative provider.
    *   [x] **Guardrails Dual Provider Support**: Can switch between `LOCAL` (Regex/Keyword) and `AZURE` (AI Content Safety) via `.env`.


### üöÄ Future Plans (‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏ï‡πà‡∏≠)

‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (Logical Order):

1.  **POC Agent Architecture & Real-time Streaming (Phase 2.5)**: *Better UX*
    *   **Agent Architecture Selection**: Research and implement appropriate patterns (RAG, ReAct, CoT, etc.).
    *   ‡∏™‡∏£‡πâ‡∏≤‡∏á Endpoint `/api/chat/stream` (SSE).
    *   ‡πÅ‡∏™‡∏î‡∏á **Thought Process** ‡πÅ‡∏•‡∏∞ **Streaming Tokens** (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô ChatGPT).


2.  **Game Engine (Phase 3)**: *Core Logic*
    *   ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Code ‡πÄ‡∏Å‡∏° (Model/Loop).

3.  **Basic Simulation (Phase 4)**: *Validation*
    *   ‡πÄ‡∏≠‡∏≤ Agent ‡∏°‡∏≤‡∏ß‡∏¥‡πà‡∏á‡πÉ‡∏ô Engine ‡πÉ‡∏´‡πâ‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ.

4.  **Competitive AI (Phase 5)**: *Main Goal*
    *   ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏´‡πâ AI ‡πÄ‡∏Å‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ä‡∏ô‡∏∞‡πÑ‡∏î‡πâ.

5.  **Meta Analysis (Phase 6)**: *Optional*
    *   ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Deck.


---

### üõ† Technology Stack
*   **Language**: Python 3.10+
*   **Frameworks**: FastAPI, LangChain / LangGraph
*   **Database**: ChromaDB (Vector)
    *   *Note:* Data Pipeline includes a **Cleaning & Deduplication** step to filter unique card numbers.
*   **Tools**: `uv` (Package Manager)
    *   Virtual Environment Commands
        *   **Windows**: `.venv\Scripts\Activate.ps1` (or simply `.venv\Scripts\python.exe` to run directly)
        *   **macOS / Linux**: `source .venv/bin/activate`

### üê≥ How to Run with Docker

1.  **Environment Setup**:
    Copy `.env.example` to `.env` and fill in your API keys.
    ```bash
    cp .env.example .env
    ```

2.  **Run with Docker Compose**:
    ```bash
    docker-compose -f docker/docker-compose.yml up --build
    ```
    The API will be available at `http://localhost:8000/docs`.

3.  **Data Persistence**:
    The `data` folder is mounted as a volume, so your Vector DB and JSON data persist between restarts.
