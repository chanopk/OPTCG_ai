# OPTCG AI Service

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ **OPTCG AI Service** ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö AI Agent ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°, ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå (Simulation) ‡∏Ç‡∏≠‡∏á **One Piece Card Game** ‡πÇ‡∏î‡∏¢‡∏°‡∏∏‡πà‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ LLM ‡πÅ‡∏•‡∏∞ Multi-Agent Systems ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤

### üéØ Project Scope & Specification (‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡πà‡∏≠)

‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á AI ‡∏ó‡∏µ‡πà "‡∏£‡∏π‡πâ‡∏à‡∏£‡∏¥‡∏á" ‡πÅ‡∏•‡∏∞ "‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô" ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö OPTCG:

1.  **Card Knowledge**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Effect, Attribute ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Hybrid Search: Vector + Structured Data).
2.  **Rule Understanding**: ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à Flow ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô.
3.  **Simulation Engine**: ‡∏°‡∏µ Python Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ (Battle Simulator) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ Win Rate ‡∏Ç‡∏≠‡∏á Deck (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï).
4.  **Meta Analysis**: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° Meta ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î Deck (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï).

---

### ‚úÖ What has been done (‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)

‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á **Phase 1: Foundation & Knowledge Base**

*   **Project Initialization**:
    *   [x] Setup Project Structure ‡πÅ‡∏•‡∏∞ Environment (`uv`).
    *   [x] ‡∏™‡∏£‡πâ‡∏≤‡∏á Git Repository.
*   **Data Ingestion Pipeline**:
    *   [x] ‡∏û‡∏±‡∏í‡∏ô‡∏≤ Script (`fetch_group_id.py`, `fetch_cards.py`) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å TCGPlayer API.
    *   [x] ‡∏£‡∏∞‡∏ö‡∏ö Filter ‡πÅ‡∏¢‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Card Product ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Group ID (Series).
    *   [x] **Data Cleaning**: ‡πÄ‡∏û‡∏¥‡πà‡∏° step Deduplication ‡∏Å‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ã‡πâ‡∏≥ (Number ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô) ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ DB.
    *   [x] **Multi-Model Embeddings**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡πÉ‡∏ä‡πâ `Google Gemini` ‡∏´‡∏£‡∏∑‡∏≠ `Local HuggingFace` ‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô config.
    *   [ ] optimize ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
    *   [x] ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Raw Data ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Indexing ‡∏•‡∏á Vector DB.
    *   [x] **Knowledge Base Automation**: ‡∏™‡∏£‡πâ‡∏≤‡∏á `check_for_updates.py` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Pipeline (Fetch -> Install -> Index) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥.
    *   [x] **Hybrid Search System**:
        *   Setup **ChromaDB** ‡∏û‡∏£‡πâ‡∏≠‡∏° **Gemini Embeddings**.
        *   ‡∏™‡∏£‡πâ‡∏≤‡∏á **Search Engine** ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á Semantic (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢) ‡πÅ‡∏•‡∏∞ Structured Filter (‡∏™‡∏µ, Cost, Type).
        *   ‡∏°‡∏µ Tool `query_cards.py` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤.
    *   [x] **Rule Search System**:
        *   ‡πÄ‡∏û‡∏¥‡πà‡∏° Vector Store ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏é‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤ (`rules_v1`).
        *   Implement `retrieve_rules` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏é.
        *   **Configurable Provider**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ Model ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    *   [x] **Easy-to-Use Tools**: `query_cards.py` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞ API Endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Agent.
    *   [x] **AI Agent Development**:
        *   [x] **LangGraph Agent**:
            *   ‡∏™‡∏£‡πâ‡∏≤‡∏á Basic Knowledge Agent ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Multi-tool (Card Search + Rule Search).
            *   ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Embedding Model ‡πÄ‡∏õ‡πá‡∏ô `text-embedding-004` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î.

## Embedding Configuration
‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Embedding Model ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå `.env`:
```env
# ‡πÉ‡∏ä‡πâ Google Gemini API (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Quota)
EMBEDDING_PROVIDER=google_genai
GOOGLE_API_KEY=your_key

# ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Local Model (Off-line, ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î Quota)
EMBEDDING_PROVIDER=huggingface
```
‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏¢‡∏Å Database ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (`chroma_db_gemini` ‡∏´‡∏£‡∏∑‡∏≠ `chroma_db_huggingface`) ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Provider ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Re-index ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `uv run data/embed_loader.py`

---

### üöÄ Future Plans (‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏ï‡πà‡∏≠)

‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç):

1.  **AI Agent Development (Next Step)**:
    *   [x] ‡∏û‡∏±‡∏í‡∏ô‡∏≤ **LangGraph** Agent ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ Search Tool ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ.
    *   [x] ‡∏™‡∏£‡πâ‡∏≤‡∏á FastAPI Endpoint (`/api/chat`) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Frontend ‡∏´‡∏£‡∏∑‡∏≠ Client ‡∏≠‡∏∑‡πà‡∏ô‡πÜ.

2.  **Game Engine (Phase 2)**:
    *   [ ] ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Class Design (Game, Player, Card) ‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Python.
    *   [ ] ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Game Loop ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Draw, Don!! Phase, Main Phase).

4.  **Simulation & Meta Agent (Phase 3-4)**:
    *   [ ] ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Data Deck List.
    *   [ ] ‡∏ó‡∏≥‡∏£‡∏∞‡∏ö‡∏ö Simulation ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Run ‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥.

---

### üõ† Technology Stack
*   **Language**: Python 3.10+
*   **Frameworks**: FastAPI, LangChain / LangGraph
*   **Database**: ChromaDB (Vector)
    *   *Note:* Data Pipeline includes a **Cleaning & Deduplication** step to filter unique card numbers.
*   **Tools**: `uv` (Package Manager)
